# =============================================================================
# SET Comprobantes Backend — Variables de entorno
# Copiar este archivo a .env y completar los valores reales.
# NUNCA commitear .env al repositorio.
# =============================================================================

# -----------------------------------------------------------------------------
# Servidor HTTP (Fastify)
# -----------------------------------------------------------------------------
PORT=4000
NODE_ENV=development
DEBUG=false

# -----------------------------------------------------------------------------
# PostgreSQL
# Formato: postgresql://usuario:contraseña@host:puerto/nombre_db
# -----------------------------------------------------------------------------

POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=set_comprobantes
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password

DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
DB_POOL_MIN=2
DB_POOL_MAX=10

# -----------------------------------------------------------------------------
# Seguridad — Cifrado AES-256-GCM
# Mínimo 32 caracteres. CRÍTICO: nunca cambiar en producción sin re-cifrar DB.
# En producción usar HashiCorp Vault o AWS Secrets Manager.
# -----------------------------------------------------------------------------
ENCRYPTION_KEY=change_me_32_chars_minimum_please!

# -----------------------------------------------------------------------------
# SolveCaptcha — Resolución de reCAPTCHA para descarga XML en eKuatia
# Obtener API Key en: https://solvecaptcha.com/
# Se puede sobreescribir por tenant en tenant_config.extra_config.solvecaptcha_api_key
# -----------------------------------------------------------------------------
SOLVECAPTCHA_API_KEY=your_solvecaptcha_api_key_here

# -----------------------------------------------------------------------------
# Worker — Cola de jobs PostgreSQL
# -----------------------------------------------------------------------------
WORKER_POLL_INTERVAL_MS=5000
WORKER_MAX_CONCURRENT_JOBS=3
# Minutos que un job puede estar en estado RUNNING antes de ser reiniciado a PENDING
STUCK_JOB_TIMEOUT_MINUTES=60

# -----------------------------------------------------------------------------
# Scheduler — Expresión cron para encolar sincronizaciones automáticas
# Formato estándar: minuto hora dia-mes mes dia-semana
# Ejemplos:
#   */5 * * * *   → cada 5 minutos (default)
#   0 * * * *     → cada hora en punto
#   0 3 * * *     → todos los días a las 3:00 AM
#   0 */2 * * *   → cada 2 horas
# -----------------------------------------------------------------------------
CRON_SCHEDULE=*/5 * * * *

# -----------------------------------------------------------------------------
# Puppeteer — Automatización headless de Marangatu
# PUPPETEER_HEADLESS=false para ver el browser durante desarrollo/debug
# -----------------------------------------------------------------------------
PUPPETEER_HEADLESS=true
# Timeout en ms para navegación y waitForFunction en Puppeteer.
# Para eKuatia se usa al menos 30000ms independientemente de este valor.
PUPPETEER_TIMEOUT_MS=30000
MARANGATU_BASE_URL=https://marangatu.set.gov.py

# -----------------------------------------------------------------------------
# eKuatia — Portal de Documentos Electrónicos de la SET
# EKUATIA_RECAPTCHA_SITE_KEY: site key de reCAPTCHA v2 de /consultas/
# Verificar en: https://ekuatia.set.gov.py/consultas/ (Network > grecaptcha)
# -----------------------------------------------------------------------------
EKUATIA_BASE_URL=https://ekuatia.set.gov.py
EKUATIA_RECAPTCHA_SITE_KEY=6Ldcb-wrAAAAAGp5mRQLnbGW0GFsKyi71OhYDImu

# -----------------------------------------------------------------------------
# Cloudflare R2 — Almacenamiento de objetos (exports, extractos bancarios)
# Si R2_ENABLED=false, los archivos se retornan como buffer directo (modo dev)
# -----------------------------------------------------------------------------
R2_ENABLED=false
R2_ACCOUNT_ID=
R2_ACCESS_KEY_ID=
R2_SECRET_ACCESS_KEY=
R2_BUCKET_NAME=sedia-storage
R2_PUBLIC_URL=https://sedia-storage.rohekawebservices.online
